<!DOCTYPE html>
<html lang="de-formal">

<head>
    <title>Challenge</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css" />

</head>

<body>

    <div id=select>
        <label>Zeitraum festlegen: <input id="duration" type="date" name="duration"></label><br>

        <input type="button" value="getChallenges" onclick="getChallenges()"> <!-- noch Ã¤ndern auf onLoad -->
        <div id="challengeContainer"></div><br>

        <input type="button" value="Send" onclick="sendSelected()">
        <div id=selectedConfirmation>Status</div>
    </div>


    <script>

        async function getChallenges() {
            const x = await fetch('/challenges');
            const challenges = await x.json();
            for (oneChallenge of challenges) {

                const id = oneChallenge.ID;
                const text = oneChallenge.Description;
                
                let divE = document.createElement("div")
                let labelE = document.createElement("LABEL");
                labelE.id = "id_" + id;

                let challenge = document.createElement("INPUT");
                challenge.type = "checkbox";
                challenge.name = "challenge";
                challenge.value = id;

                labelE.appendChild(challenge);
                labelE.appendChild(document.createTextNode(text));
                divE.appendChild(labelE)
                document.getElementById("challengeContainer").appendChild(divE);

            }
        }


        async function sendSelected() {
            let challengeCont = document.getElementById("challengeContainer")
            let challengeList = []
            challengeCont.childNodes.forEach(divElement => {
                let labelE = divElement.childNodes[0]
                let inputE = labelE.childNodes[0]
                challengeList = [...challengeList, {id: inputE.value, status: inputE.checked}]
            });
            const parDuration = document.getElementById('duration').value;

            const x = await fetch('/challenge/select', data = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    challenges: challengeList,
                    duration: parDuration,
                })
            });
            const result = await x.json()
            document.getElementById("selectedConfirmation").innerHTML = result.message;
        }


        async function getUserChallenges() {
            const x = await fetch('/userChallenges');
            const userChallenges = await x.json();
            console.log(userChallenges);

            document.getElementById("userChallenges").innerHTML = userChallenges;
        }

    </script>

</body>

</html>